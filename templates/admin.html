{% extends "base.html" %}

{% block title %}Admin Panel - Resh{% endblock %}

{% block content %}
<div class="container-fluid py-5">
    <div class="row">
        <div class="col-lg-3 mb-4">
            <div class="admin-sidebar">
                <h4 class="mb-4">
                    <i class="fas fa-cog text-accent mr-2"></i>Admin Panel
                </h4>

                <ul class="nav nav-pills flex-column admin-nav" id="adminTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="dashboard-tab" data-toggle="pill" href="#dashboard" role="tab">
                            <i class="fas fa-chart-bar mr-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="products-tab" data-toggle="pill" href="#products" role="tab">
                            <i class="fas fa-shoe-prints mr-2"></i>Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="orders-tab" data-toggle="pill" href="#orders" role="tab">
                            <i class="fas fa-shopping-cart mr-2"></i>Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="add-product-tab" data-toggle="pill" href="#add-product" role="tab">
                            <i class="fas fa-plus mr-2"></i>Add Product
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-lg-9">
            <div class="tab-content admin-content" id="adminTabsContent">

                <!-- Dashboard Tab -->
                <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                    <div class="admin-section">
                        <h4 class="mb-4">Dashboard Overview</h4>

                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-shopping-cart text-accent"></i>
                                    </div>
                                    <div class="stat-info">
                                        <h3>{{ orders|length }}</h3>
                                        <p>Total Orders</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-shoe-prints text-success"></i>
                                    </div>
                                    <div class="stat-info">
                                        <h3>{{ products.values() | map('length') | sum }}</h3>
                                        <p>Total Products</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-rupee-sign text-warning"></i>
                                    </div>
                                    <div class="stat-info">
                                        <h3>₹{{ "{:,.0f}".format(orders | map(attribute='total') | sum if orders else 0) }}</h3>
                                        <p>Total Revenue</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-clock text-info"></i>
                                    </div>
                                    <div class="stat-info">
                                        <h3>{{ orders | selectattr('status', 'equalto', 'pending') | list | length }}</h3>
                                        <p>Pending Orders</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="recent-activity">
                            <h5 class="mb-3">Recent Orders</h5>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Order #</th>
                                            <th>Total</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for order in orders[:5] %}
                                        <tr>
                                            <td>#{{ order['order_number'] }}</td>
                                            <td>₹{{ "{:,.0f}".format(order['total']) }}</td>
                                            <td>
                                                <span class="badge badge-{% if order['status'] == 'completed' %}success{% elif order['status'] == 'pending' %}warning{% else %}info{% endif %}">
                                                    {{ order['status']|title }}
                                                </span>
                                            </td>
                                            <td>{{ order['created_at'] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Tab -->
                <div class="tab-pane fade" id="products" role="tabpanel">
                    <div class="admin-section">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4>Manage Products</h4>
                            <button class="btn btn-accent" onclick="$('#add-product-tab').click()">
                                <i class="fas fa-plus mr-2"></i>Add New Product
                            </button>
                        </div>

                        <div class="products-grid">
                            {% for brand, brand_products in products.items() %}
                            <div class="brand-section mb-4">
                                <h5 class="brand-title">{{ brand|title }}</h5>
                                <div class="row">
                                    {% for product in brand_products %}
                                    <div class="col-md-4 mb-3">
                                        <div class="admin-product-card">
                                            <img src="{{ url_for('static', filename='placeholder.svg') }}" alt="{{ product.name }}" class="img-fluid">
                                            <div class="product-info">
                                                <h6>{{ product.name }}</h6>
                                                <p class="price">₹{{ "{:,.0f}".format(product.price) }}</p>
                                                <div class="product-actions">
                                                    <button class="btn btn-sm btn-outline-primary" onclick="editProduct({{ product.id }})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct({{ product.id }})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div class="tab-pane fade" id="orders" role="tabpanel">
                    <div class="admin-section">
                        <h4 class="mb-4">Order Management</h4>

                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for order in orders %}
                                    <tr>
                                        <td>#{{ order['order_number'] }}</td>
                                        <td>User {{ order['user_id'] }}</td>
                                        <td>{{ loads(order['items']) | length if order['items'] else 0 }} items</td>
                                        <td>₹{{ "{:,.0f}".format(order['total']) }}</td>
                                        <td>
                                            <select class="form-control form-control-sm" onchange="updateOrderStatus({{ order['id'] }}, this.value)">
                                                {% for s in ['pending','processing','shipped','delivered','cancelled'] %}
                                                <option value="{{ s }}" {% if order['status'] == s %}selected{% endif %}>{{ s.title() }}</option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                        <td>{{ order['created_at'] }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-info" onclick="viewOrder({{ order['id'] }})">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Add Product Tab (same as before, no changes needed) -->
                {{ super() }}

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function editProduct(productId) {
    alert('Edit product functionality would be implemented here');
}
function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product?')) {
        alert('Delete product functionality would be implemented here');
    }
}
function updateOrderStatus(orderId, status) {
    console.log(`Updating order ${orderId} to ${status}`);
}
function viewOrder(orderId) {
    alert('View order details functionality would be implemented here');
}
document.querySelector('.add-product-form')?.addEventListener('submit', function(e) {
    e.preventDefault();
    const sizes = Array.from(document.querySelectorAll('.size-checkboxes input:checked')).map(cb => cb.value);
    if (sizes.length === 0) {
        alert('Please select at least one size');
        return;
    }
    alert('Product added successfully!');
    this.reset();
});
</script>
{% endblock %}
