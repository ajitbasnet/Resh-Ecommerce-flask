{% extends "base.html" %}
{% block title %}Admin Panel - Resh{% endblock %}

{% block content %}
<div class="container-fluid py-5">
    <div class="row">
        <div class="col-lg-3 mb-4">
            <div class="admin-sidebar">
                <h4 class="mb-4"><i class="fas fa-cog text-accent mr-2"></i>Admin Panel</h4>
                <ul class="nav nav-pills flex-column admin-nav" id="adminTabs" role="tablist">
                    <li class="nav-item"><a class="nav-link active" id="dashboard-tab" data-toggle="pill" href="#dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" id="products-tab" data-toggle="pill" href="#products">Products</a></li>
                    <li class="nav-item"><a class="nav-link" id="orders-tab" data-toggle="pill" href="#orders">Orders</a></li>
                    <li class="nav-item"><a class="nav-link" id="add-product-tab" data-toggle="pill" href="#add-product">Add Product</a></li>
                </ul>
            </div>
        </div>

        <div class="col-lg-9">
            <div class="tab-content admin-content" id="adminTabsContent">

                <!-- Dashboard -->
                <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                    <div class="admin-section">
                        <h4 class="mb-4">Dashboard Overview</h4>
                        <div class="row mb-4">
                            <div class="col-md-3"><div class="stat-card"><h3>{{ orders|length }}</h3><p>Total Orders</p></div></div>
                            <div class="col-md-3"><div class="stat-card"><h3>{{ products.values() | map('length') | sum }}</h3><p>Total Products</p></div></div>
                            <div class="col-md-3"><div class="stat-card"><h3>₹{{ orders | sum(attribute='total') | int }}</h3><p>Total Revenue</p></div></div>
                            <div class="col-md-3"><div class="stat-card"><h3>{{ orders | selectattr('status', 'equalto', 'pending') | list | length }}</h3><p>Pending Orders</p></div></div>
                        </div>

                        <div class="recent-activity">
                            <h5 class="mb-3">Recent Orders</h5>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead><tr><th>Order #</th><th>Total</th><th>Status</th><th>Date</th></tr></thead>
                                    <tbody>
                                    {% for order in orders[:5] %}
                                        <tr>
                                            <td>#{{ order['order_number'] }}</td>
                                            <td>₹{{ "{:,.0f}".format(order['total']) }}</td>
                                            <td><span class="badge badge-{% if order['status'] == 'completed' %}success{% elif order['status'] == 'pending' %}warning{% else %}info{% endif %}">{{ order['status']|title }}</span></td>
                                            <td>{{ order['created_at'] }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products -->
                <div class="tab-pane fade" id="products" role="tabpanel">
                    <div class="admin-section">
                        <h4 class="mb-4">Manage Products</h4>
                        {% for brand, brand_products in products.items() %}
                        <h5 class="brand-title">{{ brand|title }}</h5>
                        <div class="row">
                            {% for product in brand_products %}
                            <div class="col-md-4 mb-3">
                                <div class="admin-product-card">
                                    <img src="{{ url_for('static', filename=product.image) }}" class="img-fluid">
                                    <div class="product-info">
                                        <h6>{{ product.name }}</h6>
                                        <p>₹{{ "{:,.0f}".format(product.price) }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Orders -->
                <div class="tab-pane fade" id="orders" role="tabpanel">
                    <div class="admin-section">
                        <h4 class="mb-4">Order Management</h4>
                        <table class="table table-hover">
                            <thead><tr><th>Order ID</th><th>User ID</th><th>Items</th><th>Total</th><th>Status</th><th>Date</th></tr></thead>
                            <tbody>
                            {% for order in orders %}
                                <tr>
                                    <td>#{{ order['order_number'] }}</td>
                                    <td>{{ order['user_id'] }}</td>
                                    <td>{{ loads(order['items']) | length }} items</td>
                                    <td>₹{{ "{:,.0f}".format(order['total']) }}</td>
                                    <td>{{ order['status'] }}</td>
                                    <td>{{ order['created_at'] }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Product -->
                <div class="tab-pane fade" id="add-product" role="tabpanel">
                    <div class="admin-section">
                        <h4 class="mb-4">Add Product (Coming Soon)</h4>
                        <p>Product add functionality will be implemented later.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}
